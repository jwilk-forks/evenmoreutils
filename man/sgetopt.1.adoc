SGETOPT(1)
==========

NAME
----
sgetopt - Parse command-line options


SYNOPSIS
--------

	#include <sgetopt.h>

	int sgetopt(int argc,
	            char * const argv[],
	            const struct soption optable[],
	            char *normal_args[],
	            int stop_at_nonoption);


DESCRIPTION
-----------
The *sgetopt*() function parses command-line arguments.  It parses arguments in
a similar way to *getopt*(), albeit with a different interface.

The first two arguments, 'argc' and 'argv' have their usual meaning: count and
command line arguments.  The 'optable' argument is an array of 'struct
soption', containing the description of how to process the arguments.  The
'normal_args' will be written with all the non-option arguments, it 'should'
have space for 'argc+1' elements.  For convenience, 'normal_args' can be
pointed to 'argv', which, in this case, will be overwritten.  The last argument is
'stop_at_nonoption' which indicates wether sgetopt should stop processing at
the first non-option: this is useful when writting programs that run other
command line programs.

The struct soption is as follows, with comments describing what are each component:

	struct soption {
	    char sname;                      /* short name, e.g.: 'h'    */
	    char *lname;                     /* long name,  e.g.: "help" */
	    int has_arg;                     /* takes argument?  1 or 0  */
	    int (*func)(const char*,void*);  /* handling callback        */
	    void *arg;                       /* value passed to callback */
	};

In this structure, 'sname' and 'lname' are respectively the short and long
versions of the option, e.g.: \'h\' (for -h) and "--help" (for --help).  The
boolean 'has_arg' indicates wether the option takes an argument (-l10, -l 10,
--length=10 or --length 10).

The 'func' is a callback which will process the argument, itself takes two
arguments, the argument to the command, if there is any, and a pointer to 'arg'
provided in the 'soption' struct.


RETURN VALUE
------------

This function returns 0 on success.  On error, it returns either 1 when
processing the arguments themselves, or the error code returned by one of the
'func' callbacks -- this way you can capture your own errors.


EXAMPLES
--------

*Parsing short options*

The following example program uses *sgetopt*() to handle two program options:
'-n', with no associated value; and '-t' 'val', which expects an associated
string.  This has 'intentionally' the same functionality as the first example
provided in the *getopt*(3) manpage of version 3.66 of the Linux *man-pages*
project.

	#include <sgetopt.h>
	#include <stdlib.h>
	#include <stdio.h>
	
	int main(int argc, char **argv)
	{
	    static int flags, nsecs = -1;
	
	    static struct soption opttable[] = {
	        { 'n', NULL, 0, capture_presence, &flags },
	        { 't', NULL, 1, capture_int,      &nsecs },
	        { 0,   0,    0, 0,                0 }
	    };
	
	    if (sgetopt(argc, argv, opttable, argv+1, 0)) {
	        fprintf(stderr,"Usage: %s [-t nsecs] [-n] name\n",argv[0]);
	        exit(EXIT_FAILURE);
	    }
	
	    printf("flags=%d; nsecs=%d\n", flags, nsecs);
	
	    if (argv[1] == NULL) {
	        fprintf(stderr, "Expected argument after options\n");
	        exit(EXIT_FAILURE);
	    }
	
	    printf("name argument = %s\n", argv[1]);
	
	    /* Other code ommitted */
	
	    exit(EXIT_SUCCESS);
	}

TODO: Fix indentation above.
TODO: Make another simple example while keeping this one.

*Parsing long options*



BUGS
----
This documentation can, and will eventually, be improved.

Report bugs to rudy@matela.com.br


SEE ALSO
--------
*getopt*(3), *getsubopt*(3)


COPYRIGHT
---------
Copyright (C) 2012-2014 Rudy Matela. Free use of this software is granted under the
terms of the GNU General Public License version 2 or any later version.

